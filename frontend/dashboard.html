<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - AI Ticket System</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css?v=20260220-dashboard">
</head>
<body class="dashboard-page">

<!-- PROTECT PAGE -->
<script>
  const user = JSON.parse(localStorage.getItem("user"));
  if (!user) window.location.href = "login.html";
</script>

<nav class="navbar">
  <div class="nav-container">
    <a href="index.html" class="logo">
      <div class="logo-icon">AI</div>
      AI Ticket
    </a>

    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="create.html">Create Ticket</a></li>
      <li><a href="dashboard.html" class="active">Dashboard</a></li>
      <li><a href="history.html">History</a></li>
      <li><a href="help.html">Help Center</a></li>
      <li id="authLink"></li>
    </ul>
  </div>
</nav>

<main class="dashboard-shell">
  <section class="dashboard-head">
    <p class="dashboard-kicker">Operations View</p>
    <h1>Support Dashboard</h1>
    <p>Monitor ticket flow, open details, and resolve requests from one place.</p>
  </section>

  <section class="dashboard-stats">
    <article>
      <p>Total Tickets</p>
      <h3 id="statTotal">0</h3>
    </article>
    <article>
      <p>Open</p>
      <h3 id="statOpen">0</h3>
    </article>
    <article>
      <p>Resolved</p>
      <h3 id="statResolved">0</h3>
    </article>
    <article>
      <p>Avg. Confidence</p>
      <h3 id="statConfidence">--</h3>
    </article>
  </section>

  <section class="dashboard-table-card">
    <div class="dashboard-table-head">
      <h2>All Tickets</h2>
      <span id="dashboardMeta">Sorted by recent activity</span>
    </div>
    <div class="dashboard-controls">
      <input id="ticketSearch" type="text" placeholder="Search by title, category, priority, status, or ID">
      <select id="statusFilter">
        <option value="">All Status</option>
        <option value="open">Open</option>
        <option value="resolved">Resolved</option>
      </select>
      <select id="categoryFilter">
        <option value="">All Category</option>
        <option value="technical">Technical</option>
        <option value="billing">Billing</option>
        <option value="general">General</option>
        <option value="hardware">Hardware</option>
        <option value="account">Account</option>
      </select>
      <select id="priorityFilter">
        <option value="">All Priority</option>
        <option value="high">High</option>
        <option value="medium">Medium</option>
        <option value="low">Low</option>
      </select>
      <select id="sortFilter">
        <option value="recent">Sort: Newest</option>
        <option value="oldest">Sort: Oldest</option>
        <option value="priority">Sort: Priority</option>
        <option value="confidence">Sort: Confidence</option>
      </select>
      <button id="clearFilters" class="control-btn" type="button">Reset</button>
    </div>

    <div class="table-container">
      <table class="ticket-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Ticket</th>
            <th>Priority</th>
            <th>Confidence</th>
            <th>Status</th>
            <th>Created</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody id="ticketsBody">
          <tr>
            <td colspan="7" style="text-align:center;padding:30px;">
              Loading tickets...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</main>

<!-- ================= MODAL POPUP ================= -->
<div id="ticketModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">Ticket Details</div>
      <button class="close-btn" onclick="closeModal()">×</button>
    </div>

    <div class="modal-body">
      <div class="modal-grid">
        <div class="modal-label">Ticket ID</div>
        <div id="m_id"></div>

        <div class="modal-label">Category</div>
        <div id="m_category"></div>

        <div class="modal-label">Priority</div>
        <div id="m_priority"></div>

        <div class="modal-label">Confidence</div>
        <div id="m_confidence"></div>

        <div class="modal-label">Status</div>
        <div id="m_status"></div>

        <div class="modal-label">Created</div>
        <div id="m_created"></div>
      </div>

      <div class="modal-label">Description</div>
      <div id="m_description" class="modal-description"></div>
    </div>
  </div>
</div>
<!-- ================================================= -->

<footer class="footer">
  <div class="footer-content">
    <ul class="footer-links">
      <li><a href="#" class="about-link">About</a></li>
      <li><a href="#" class="privacy-policy-link">Privacy Policy</a></li>
      <li><a href="help.html#contact">Contact</a></li>
    </ul>
    <div class="footer-copy">
      © 2026 AI Ticket System. All rights reserved.
    </div>
  </div>
</footer>

<!-- LOGIN / LOGOUT -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const authLink = document.getElementById("authLink");
    const user = JSON.parse(localStorage.getItem("user"));

    if (!authLink) return;

    if (user) {
      const rawLabel = String(user.name || user.email || "Account");
      const label = rawLabel.split(" ")[0];
      const initial = label.charAt(0).toUpperCase();
      authLink.innerHTML = `
        <div class="auth-menu">
          <button type="button" class="auth-menu-toggle">
            <span class="auth-avatar">${initial}</span>
            <span class="auth-label">${label}</span>
            <span class="auth-caret">▾</span>
          </button>
          <div class="auth-dropdown">
            <a href="profile.html" class="auth-menu-item">Profile</a>
            <a href="settings.html" class="auth-menu-item">Settings</a>
            <button type="button" class="auth-menu-item auth-logout-btn">Logout</button>
          </div>
        </div>`;
    } else {
      authLink.innerHTML = `<a href="login.html">Login</a>`;
    }
  });
</script>

<script src="js/runtime-config.js"></script>
  <script src="js/app.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user) {
      window.location.replace("login.html");
    }
  });
</script>

</body>
</html>
